<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>活动清单 - 仿苹果风</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="common.css">
    <style>
        .activity-list {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .activity-header {
            padding: 16px;
            border-bottom: 1px solid #f5f5f7;
        }

        .activity-title {
            font-size: 16px;
            font-weight: 500;
            color: #6e6e73;
            margin: 0;
        }

        .activity-item {
            padding: 16px;
            border-bottom: 1px solid #f5f5f7;
            display: flex;
            gap: 16px;
            transition: all 0.2s ease;
            position: relative;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-item:hover {
            background-color: #fafafa;
        }

        .activity-item.dragging {
            opacity: 0.5;
            background-color: #f0f0f0;
        }

        .activity-item.over {
            background-color: #f5f5f7;
        }

        .activity-index {
            width: 24px;
            text-align: center;
            color: #6e6e73;
            font-size: 14px;
        }

        .activity-content {
            flex-grow: 1;
        }

        .activity-name {
            font-size: 16px;
            font-weight: 400;
            margin: 0;
        }

        .activity-date {
            font-size: 14px;
            color: #6e6e73;
        }

        .activity-completed .activity-name,
        .activity-completed .activity-date {
            text-decoration: line-through;
            color: #6e6e73;
        }

        .activity-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* 移动端适配 */
        @media (max-width: 600px) {
            .activity-item {
                padding: 12px;
                gap: 12px;
            }

            .activity-index {
                width: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">活动清单</h1>
            <p class="subtitle">管理你的活动和番茄钟</p>
        </div>

        <div class="input-container">
            <div class="form-group">
                <div class="form-row">
                    <div class="form-control">
                        <label for="taskInput" class="form-label">活动名称</label>
                        <input type="text" id="taskInput" placeholder="输入活动名称（最多15字）" maxlength="15"
                               class="form-input" onkeydown="handleEnter(event)">
                    </div>

                    <div class="form-control">
                        <label for="deadlineInput" class="form-label">截止日期</label>
                        <input type="date" id="deadlineInput" class="form-input">
                    </div>

                    <div class="form-control">
                        <label for="pomodoroInput" class="form-label">番茄数量</label>
                        <input type="number" id="pomodoroInput" min="0" max="9" placeholder="番茄数（0~9）"
                               class="form-input" onkeydown="handleEnter(event)">
                    </div>

                    <div class="form-control" style="flex: 0 0 auto;">
                        <label class="form-label">&nbsp;</label>
                        <button class="btn btn-primary" onclick="addTask()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            添加活动
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="activity-list">
            <div class="activity-header">
                <h2 class="activity-title">活动列表</h2>
            </div>
            <div id="activityItems">
                <!-- 动态添加的活动将插入到这里 -->
            </div>
        </div>
    </div>

    <script>
        const taskInput = document.getElementById('taskInput');
        const deadlineInput = document.getElementById('deadlineInput');
        const pomodoroInput = document.getElementById('pomodoroInput');
        const activityItems = document.getElementById('activityItems');

        function addTask() {
            const taskName = taskInput.value.trim();
            const deadline = deadlineInput.value;
            const pomodoroCount = parseInt(pomodoroInput.value) || 0;

            if (taskName === '') return;

            let rowNumber = activityItems.children.length + 1;

            // 创建活动项元素
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item fade-in';
            activityItem.setAttribute("draggable", "true");
            activityItem.setAttribute("data-id", Date.now()); // 使用时间戳作为唯一ID

            // 序号
            const indexElement = document.createElement('div');
            indexElement.className = 'activity-index';
            indexElement.textContent = rowNumber;

            // 活动内容
            const contentElement = document.createElement('div');
            contentElement.className = 'activity-content';

            const nameElement = document.createElement('h3');
            nameElement.className = 'activity-name';
            nameElement.textContent = taskName;

            const dateElement = document.createElement('p');
            dateElement.className = 'activity-date';

            // 格式化日期
            if (deadline) {
                const date = new Date(deadline);
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                dateElement.textContent = date.toLocaleDateString('zh-CN', options);
            } else {
                dateElement.textContent = '无截止日期';
            }

            contentElement.appendChild(nameElement);
            contentElement.appendChild(dateElement);

            // 番茄计数和删除按钮
            const controlsElement = document.createElement('div');
            controlsElement.className = 'activity-controls';

            const pomodoroContainer = document.createElement('div');
            pomodoroContainer.className = 'pomodoro-container';

            if (pomodoroCount === 0) {
                const noPomodoroText = document.createElement('span');
                noPomodoroText.className = 'no-pomodoros';
                noPomodoroText.textContent = '0';
                pomodoroContainer.appendChild(noPomodoroText);
            } else {
                for (let i = 0; i < pomodoroCount; i++) {
                    const pomodoro = document.createElement('div');
                    pomodoro.className = 'pomodoro';
                    pomodoro.setAttribute('data-index', i);
                    pomodoro.onclick = function() { togglePomodoro(pomodoro, activityItem); };
                    pomodoroContainer.appendChild(pomodoro);
                }
            }

            const deleteButton = document.createElement('button');
            deleteButton.className = 'btn-delete';
            deleteButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
            deleteButton.onclick = function() { removeTask(activityItem); };

            controlsElement.appendChild(pomodoroContainer);
            controlsElement.appendChild(deleteButton);

            // 组装活动项
            activityItem.appendChild(indexElement);
            activityItem.appendChild(contentElement);
            activityItem.appendChild(controlsElement);

            // 添加到列表
            activityItems.appendChild(activityItem);

            // 初始化拖放事件
            addDragAndDropEvents(activityItem);

            // 清空输入框
            taskInput.value = '';
            deadlineInput.value = '';
            pomodoroInput.value = '';

            // 聚焦到活动输入框
            taskInput.focus();
        }

        function removeTask(activityItem) {
            // 添加淡出动画
            activityItem.style.transition = 'all 0.3s ease';
            activityItem.style.opacity = '0';
            activityItem.style.transform = 'translateX(20px)';

            // 动画结束后移除元素
            setTimeout(() => {
                activityItem.remove();
                updateRowNumbers();
            }, 300);
        }

        function updateRowNumbers() {
            const items = document.querySelectorAll('.activity-item');
            items.forEach((item, index) => {
                item.querySelector('.activity-index').textContent = index + 1;
            });
        }

        function togglePomodoro(pomodoro, activityItem) {
            const pomodoros = activityItem.querySelectorAll('.pomodoro');
            const index = parseInt(pomodoro.getAttribute('data-index'));

            // 检查当前状态
            const isCompleted = pomodoro.classList.contains('completed');

            if (isCompleted) {
                pomodoro.classList.remove('completed');
            } else {
                pomodoro.classList.add('completed');
            }
        }

        function addDragAndDropEvents(item) {
            item.addEventListener("dragstart", function(e) {
                item.classList.add("dragging");
                e.dataTransfer.setData("text/plain", null); // 必要的 hack 来启用拖拽
                window.draggedItem = item;
            });

            item.addEventListener("dragend", function() {
                item.classList.remove("dragging");
                window.draggedItem = null;
            });

            item.addEventListener("dragover", function(e) {
                e.preventDefault();
                if (this !== window.draggedItem) {
                    this.classList.add("over");
                }
            });

            item.addEventListener("dragleave", function() {
                this.classList.remove("over");
            });

            item.addEventListener("drop", function(e) {
                e.preventDefault();
                if (this !== window.draggedItem && this.tagName === "DIV") {
                    const itemsContainer = this.parentNode;
                    const isAfter = Array.from(itemsContainer.children).indexOf(this) >
                                    Array.from(itemsContainer.children).indexOf(window.draggedItem);

                    if (isAfter) {
                        itemsContainer.insertBefore(window.draggedItem, this.nextSibling);
                    } else {
                        itemsContainer.insertBefore(window.draggedItem, this);
                    }

                    updateRowNumbers();
                }
                this.classList.remove("over");
            });
        }

        function handleEnter(e) {
            if (e.key === 'Enter') {
                addTask();
            }
        }
    </script>
</body>
</html>